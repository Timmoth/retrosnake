!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("RetroSnake",[],e):"object"==typeof exports?exports.RetroSnake=e():t.RetroSnake=e()}(self,(()=>(()=>{"use strict";var t,e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},i={};e.d(i,{default:()=>u}),function(t){t[t.Up=1]="Up",t[t.Down=2]="Down",t[t.Left=3]="Left",t[t.Right=4]="Right"}(t||(t={}));const s=function(){function e(){var e=this;this.textInput="",this.lastDirection=t.Up,this.directions=[],window.addEventListener("keydown",(function(i){"ArrowUp"===i.key?(e.directions.push(t.Up),i.preventDefault()):"ArrowDown"===i.key?(e.directions.push(t.Down),i.preventDefault()):"ArrowLeft"===i.key?(e.directions.push(t.Left),i.preventDefault()):"ArrowRight"===i.key&&(e.directions.push(t.Right),i.preventDefault()),"Backspace"!==i.key&&"Delete"!==i.key||e.textInput.length>0&&(e.textInput=e.textInput.slice(0,-1));var s=i.key.toLowerCase();if(1===s.length){if(e.textInput.length>=5)return;e.textInput+=s}}))}return e.prototype.getDirection=function(){return this.directions.length>0?this.lastDirection=this.directions.shift():this.lastDirection},e.prototype.clearText=function(){this.textInput=""},e.prototype.getText=function(){return this.textInput},e.prototype.canSubmit=function(){return this.textInput.length>=3},e}();var h=function(){function e(t,e,i,s,h,n){this.game=t,this.x=s,this.y=h,this.prev=e,this.next=null,this.direction=n,this.flipConnectorSegment=!0,this.index=i}return e.prototype.update=function(t){var e,i=this.nextPosition(),s=i[0],h=i[1];this.x=s,this.y=h,null===(e=this.next)||void 0===e||e.update(this.direction),this.direction=t},e.prototype.drawHead=function(e){var i=this.nextPosition(),s=i[0],h=i[1],n=this.game.toPixelCoord(s,h),o=n[0],r=n[1];switch(this.direction){case t.Up:e.fillRect(o,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2),e.fillRect(o+this.game.cellWidth/2,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2),e.fillRect(o,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Down:e.fillRect(o,r,this.game.cellWidth/2,this.game.cellHeight/2),e.fillRect(o+this.game.cellWidth/2,r,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Left:e.fillRect(o+this.game.cellWidth/2,r,this.game.cellWidth/2,this.game.cellHeight/2),e.fillRect(o+this.game.cellWidth/2,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Right:e.fillRect(o,r,this.game.cellWidth/2,this.game.cellHeight/2),e.fillRect(o,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2)}},e.prototype.drawBody=function(t){var e=this.game.toPixelCoord(this.x,this.y),i=e[0],s=e[1];this.index%2==0?t.fillRect(i,s,this.game.cellWidth,this.game.cellHeight):(null!==this.prev&&(this.flipConnectorSegment=this.prev.direction==this.direction?this.prev.flipConnectorSegment:!this.prev.flipConnectorSegment),this.flipConnectorSegment?(t.fillRect(i,s,this.game.cellWidth/2,this.game.cellHeight/2),t.fillRect(i+this.game.cellWidth/2,s+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2)):(t.fillRect(i,s+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2),t.fillRect(i+this.game.cellWidth/2,s,this.game.cellWidth/2,this.game.cellHeight/2)))},e.prototype.drawTail=function(e){var i=this.nextPositionReverse(),s=i[0],h=i[1],n=this.game.toPixelCoord(s,h),o=n[0],r=n[1];switch(this.direction){case t.Up:e.fillRect(o,r,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Down:e.fillRect(o,r+this.game.cellHeight/2,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Left:e.fillRect(o,r,this.game.cellWidth/2,this.game.cellHeight/2);break;case t.Right:e.fillRect(o+this.game.cellWidth/2,r,this.game.cellWidth/2,this.game.cellHeight/2)}},e.prototype.draw=function(t){var e;this.drawBody(t),null===this.prev&&this.drawHead(t),null===this.next&&this.drawTail(t),null===(e=this.next)||void 0===e||e.draw(t)},e.prototype.nextPosition=function(){var e=this.x,i=this.y;switch(this.direction){case t.Up:i--;break;case t.Down:i++;break;case t.Left:e--;break;case t.Right:e++}return[e,i]},e.prototype.nextPositionReverse=function(){var e=this.x,i=this.y;switch(this.direction){case t.Up:i++;break;case t.Down:i--;break;case t.Left:e++;break;case t.Right:e--}return[e,i]},e.prototype.grow=function(){if(null===this.next){var t=this.nextPositionReverse(),i=t[0],s=t[1];this.next=new e(this.game,this,this.index+1,i,s,this.direction);var h=this.next.nextPositionReverse();i=h[0],s=h[1],this.next.next=new e(this.game,this,this.next.index+1,i,s,this.direction)}else this.next.grow()},e.prototype.Collides=function(t,e){return this.x==t&&this.y==e||null!==this.next&&this.next.Collides(t,e)},e}();const n=h;var o=function(){function t(t){this.game=t}return t.prototype.move=function(){for(this.moveToRandomPosition();Math.abs(this.x-this.game.snake.x)+Math.abs(this.y-this.game.snake.y)<10&&!this.game.snake.Collides(this.game.snake.x,this.game.snake.y);)this.moveToRandomPosition();console.log("food position: (".concat(this.x,",").concat(this.y,")"))},t.prototype.moveToRandomPosition=function(){this.x=Math.floor(Math.random()*(this.game.horizontalCellCount-1)),this.y=Math.floor(Math.random()*(this.game.verticalCellCount-1))},t.prototype.draw=function(t){var e=this.game.toPixelCoord(this.x,this.y),i=e[0],s=e[1];i-=1,s-=1;var h=(this.game.cellWidth+2)/3,n=(this.game.cellHeight+2)/3;t.fillRect(i+h,s,h,n),t.fillRect(i+h+h,s+n,h,n),t.fillRect(i+h,s+n+n,h,n),t.fillRect(i,s+n,h,n)},t}();const r=o;var a=function(){function t(t,e){this.game=t,this.input=e,this.submitted=!1,this.textHeight=30}return t.prototype.draw=function(t){t.font="25px pixel",t.fillStyle="black",t.textBaseline="top",this.drawCenteredText(t,"Enter your name",this.game.headerHeight+2*this.game.borderThickness+this.textHeight);var e=String(this.input.getText()).padStart(5,"_").toString();this.drawCenteredText(t,e,this.game.headerHeight+2*this.game.borderThickness+2*this.textHeight),this.input.canSubmit()&&this.drawCenteredText(t,"Submit",this.game.height-2*this.game.borderThickness-3*this.textHeight),this.drawCenteredText(t,"Click to play again",this.game.height-4*this.game.borderThickness)},t.prototype.drawCenteredText=function(t,e,i){t.fillText(e,(this.game.width-t.measureText(e).width)/2,i)},t.prototype.submit=function(){return t=this,e=void 0,s=function(){var t,e,i;return function(t,e){var i,s,h,n,o={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return n={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function r(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;n&&(n=0,r[0]&&(o=0)),o;)try{if(i=1,s&&(h=2&r[0]?s.return:r[0]?s.throw||((h=s.return)&&h.call(s),0):s.next)&&!(h=h.call(s,r[1])).done)return h;switch(s=0,h&&(r=[2&r[0],h.value]),r[0]){case 0:case 1:h=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((h=(h=o.trys).length>0&&h[h.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!h||r[1]>h[0]&&r[1]<h[3])){o.label=r[1];break}if(6===r[0]&&o.label<h[1]){o.label=h[1],h=r;break}if(h&&o.label<h[2]){o.label=h[2],o.ops.push(r);break}h[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{i=h=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),console.log("submitting score"),[4,fetch("".concat(this.game.apiUrl,"/api/snake/highscores"),{method:"POST",body:JSON.stringify({name:this.input.getText(),score:this.game.score}),headers:{"Content-Type":"application/json",Accept:"application/json",sessionid:"07daa504-864b-4055-a115-113a9d8d31d6",userid:"07daa504-864b-4055-a115-113a9d8d31d6"}})];case 1:if(!(t=s.sent()).ok)throw new Error("Error! status: ".concat(t.status));return[4,t.json()];case 2:return e=s.sent(),console.log("result is: ",JSON.stringify(e,null,4)),[2,e];case 3:return i=s.sent(),console.log("unexpected error: ",i),[2,null];case 4:return[2]}}))},new((i=void 0)||(i=Promise))((function(h,n){function o(t){try{a(s.next(t))}catch(t){n(t)}}function r(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?h(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}a((s=s.apply(t,e||[])).next())}));var t,e,i,s},t.prototype.handleClick=function(t,e){var i=this,s=this.game.height-4*this.game.borderThickness,h=this.game.height-2*this.game.borderThickness-3*this.textHeight;e-s>=0&&e-s<=this.textHeight?(this.game.setup(),this.game.gameOver.submitted=!1):e-h>=0&&e-h<=this.textHeight&&this.game.input.canSubmit()&&this.game.gameOver.submit().then((function(t){null==t.scores?(i.game.highscores.scores=[],i.game.highscores.scores.push(new Score(0,i.game.input.getText(),i.game.score)),alert("Oops, something went wrong submitting your highscore!")):i.game.highscores.scores=t.scores,i.game.gameOver.submitted=!0}))},t}();const l=a;var c=function(){function t(t){this.game=t,this.scores=[]}return t.prototype.draw=function(t){t.font="25px pixel",t.fillStyle="black",t.textBaseline="top";var e=t.measureText("00000").width;this.drawCenteredText(t,"Highscores",this.game.headerHeight+this.game.borderThickness+5),this.drawCenteredText(t,"Click to play again",this.game.height-4*this.game.borderThickness),t.font="20px pixel",e=t.measureText("00000").width,t.fillText("rank",20,this.game.headerHeight+this.game.borderThickness+25+5),t.fillText("name",this.game.width/2-e,this.game.headerHeight+this.game.borderThickness+25+5),t.fillText("score",this.game.width-e-20,this.game.headerHeight+this.game.borderThickness+25+5);for(var i=0;i<this.scores.length;i++){var s=this.scores[i],h=String(s.rank).padStart(4,"0").toString(),n=String(s.name).padEnd(5," ").toString(),o=String(s.score).padStart(4,"0").toString(),r=this.game.headerHeight+2*this.game.borderThickness+25*(i+2);t.fillText(h,20,r),t.fillText(n,this.game.width/2-e,r),t.fillText(o,this.game.width-e-20,r)}},t.prototype.drawCenteredText=function(t,e,i){t.fillText(e,(this.game.width-t.measureText(e).width)/2,i)},t}();const g=c,d=function(){function t(t,e,i){this.width=t,this.height=e,this.food=new r(this),this.input=new s,this.cellWidth=12,this.cellHeight=12,this.borderThickness=10,this.headerHeight=this.borderThickness+30,this.horizontalCellCount=Math.round((t-2*this.borderThickness)/this.cellWidth),this.verticalCellCount=Math.round((e-this.headerHeight-2*this.borderThickness)/this.cellHeight),this.lastTimeStamp=0,this.gameOver=new l(this,this.input),this.highscores=new g(this),this.apiUrl=i,this.setup()}return t.prototype.toPixelCoord=function(t,e){return[this.cellWidth*t+this.borderThickness,this.cellHeight*e+this.headerHeight+this.borderThickness]},t.prototype.update=function(t){var e;t-this.lastTimeStamp<=Math.max(this.speed,100)||(this.lastTimeStamp=t,this.running&&(this.snake.update(this.input.getDirection()),this.snake.Collides(this.food.x,this.food.y)&&(this.speed-=5,this.snake.grow(),this.food.move(),this.score++),(null===(e=this.snake.next)||void 0===e?void 0:e.Collides(this.snake.x,this.snake.y))?this.endGame("Snake eat itself"):this.snake.x<0?this.endGame("Snake hit west wall"):this.snake.x>=this.horizontalCellCount?this.endGame("Snake hit east wall"):this.snake.y<0?this.endGame("Snake hit north wall"):this.snake.y>=this.verticalCellCount&&this.endGame("Snake hit south wall")))},t.prototype.draw=function(t){if(t.strokeRect(this.borderThickness,this.borderThickness+this.headerHeight,this.width-2*this.borderThickness,this.height-this.headerHeight-2*this.borderThickness),t.beginPath(),t.moveTo(this.borderThickness-1,this.headerHeight),t.lineTo(this.width-this.borderThickness+2,this.headerHeight),t.stroke(),this.running&&(this.food.draw(t),this.snake.draw(t)),this.drawHeader(t),!this.running){if(null==this.apiUrl)return void this.setup();this.gameOver.submitted?this.highscores.draw(t):this.gameOver.draw(t)}},t.prototype.drawHeader=function(t){t.font="30px pixel",t.fillStyle="black",t.textBaseline="top";var e=String(this.score).padStart(4,"0").toString();this.running||(e+=" Game Over"),t.fillText(e,this.borderThickness,this.borderThickness)},t.prototype.drawCenteredText=function(t,e,i){t.fillText(e,(this.width-t.measureText(e).width)/2,i)},t.prototype.endGame=function(t){console.log("Game over!"),console.log("------------------"),console.log(t),console.log("Score: ".concat(this.score)),console.log("------------------"),this.running=!1},t.prototype.setup=function(){console.log("setup game"),this.score=0,this.speed=150;var t=this.horizontalCellCount/2,e=this.verticalCellCount/2;this.snake=new n(this,null,0,t,e,this.input.getDirection()),this.snake.grow(),this.food.move(),this.running=!0},t}(),u=function(){function t(t){var e=this;if(this.canvas=document.getElementById("canvas1"),null==this.canvas)throw new Error("Could not find canvas.");this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.canvas.width=500,this.canvas.height=400,this.game=new d(this.canvas.width,this.canvas.height,t),this.canvas.addEventListener("click",(function(t){if(!e.game.running){var i=e.canvas.getBoundingClientRect(),s=t.clientX-i.left,h=t.clientY-i.top;e.game.gameOver.handleClick(s,h)}})),this.game.setup()}return t.prototype.Start=function(){this.animate(0)},t.prototype.animate=function(t){var e=this;this.ctx.fillStyle="#94d300",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=4,this.ctx.fillStyle="#131903",this.game.update(t),this.game.draw(this.ctx),requestAnimationFrame((function(t){return e.animate(t)}))},t}();return i.default})()));